<!--
@license
Copyright (c) 2018 Pierre-Yves Gicquel. 
This code may only be used under the "Do whatever you want with code license"
-->
<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-form/iron-form.html">
<link rel="import" href="../../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../../bower_components/paper-radio-group/paper-radio-group.html">
<link rel="import" href="../../../bower_components/paper-radio-button/paper-radio-button.html">
<link rel="import" href="../basic-element/post-action.html">
<link rel="import" href="../helper/sharedBehavior.html">
<link rel="import" href="../static-media/staticmedia-viewer.html">
<link rel="import" href="../../styles/common-styles.html">

<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<dom-module id="mcq-activity">
    <style include="common-style">
    .outer {
        display: inline-flex;
        flex-wrap: wrap;
        flex-direction: row;
    }

    .correct {
        color: green;
    }

    .headerText {
        padding-left: 10px;
        display: inline-flex;
        align-self: center;
    }

    .resourceReadwrite {
        display: inline-flex;
        flex-direction: row;
        justify-content: space-between;
        background-color: lightgreen;
        width: 100%;
    }

    .wrong {
        color: red;
    }

    .inner {
        display: inline-flex;
        flex-wrap: wrap;
        flex-direction: column;
    }

    .mcq-body {
        padding: 10px;
    }
    </style>
    <template>
        <template is="dom-if" if="[[conceptionMode]]" restamp>
            <div class="resourceReadwrite">
                <h3 class="headerText">{{resourceLabel}}</h3>
            </div>
        </template>
        <form class=resource>
            <div class="resource">
                <div id="mcqbody" class="resource">
                    <iron-collapse id="clue">
                        <staticmedia-viewer resource-label="[[media.label]]" style="display:inline-flex;" mkdown="[[media.mkdown]]"></staticmedia-viewer>
                    </iron-collapse>
                    <div class="question" name="question">{{question}}</div>
                    [[distractors]]
                    <paper-radio-group id="mcq" class="layout vertical wrap">
                        <paper-radio-button name="resp1">{{correctAnswer}}</paper-radio-button>
                        <paper-radio-button name="resp2">{{wrongAnswer1}}</paper-radio-button>
                        <paper-radio-button name="resp3">{{wrongAnswer2}}</paper-radio-button>
                    </paper-radio-group>
                    <iron-collapse id="correct">
                        <paper-input class="correct" text="">
                            <iron-icon icon="check-circle" prefix></iron-icon>
                            <div prefix> {{correctAnswerMessage}}</div>
                        </paper-input>
                    </iron-collapse>
                    <iron-collapse id="wrong">
                        <paper-input class="wrong">
                            <iron-icon icon="cancel" prefix></iron-icon>
                            <div prefix> {{wrongAnswerMessage}}</div>
                        </paper-input>
                    </iron-collapse>
                    <div style="margin-top:40px" class="card-actions">
                        <paper-button raised on-click="validate">Valider</paper-button>
                        <template is="dom-if" if="{{showMediaButton}}" restamp=true>
                            <paper-button raised on-click="showClue">Indice</paper-button>
                        </template>
                    </div>
                </div>
            </div>
            <template is="dom-if" if="[[unitActivity]]" restamp>
                <post-action></post-action>
            </template>
        </form>
    </template>
    <script>
    (function() {
        'use strict';
        Polymer({
            is: 'mcq-activity',
            behaviors: [sharedBehavior],

            ready: function() {
                // this.hasClue=false
                this.mcqRemoved = function() {
                    this.fire('mcq-removed', null)
                }.bind(this)
                this.correctIndex = Math.floor((Math.random() * 2));
            },

            getClue: function() {
                this.set('needClue', !this.needClue);
            },

            validate: function() {

                if (this.$.mcq.selectedItem && this.$.mcq.selectedItem.innerText && this.$.mcq.selectedItem.innerText.trim() == this.correctAnswer.trim()) {
                    this.$.correct.show();
                    this.$.wrong.hide();
                } else {
                    this.$.wrong.show();
                    this.$.correct.hide();
                }
            },
            _mediaObserver: function(newval) {
                if (newval) {
                    var temp = true
                    this.set('showMediaButton', true)
                } else {
                    this.set('showMediaButton', false)
                    this.showMediaButton = false

                }
            },

            showClue: function() {
                this.$.clue.toggle()
            },


            observers: [
                '_mediaObserver(media._id)',
            ],

            properties: {
                question: {
                    type: String,
                    notify: true,
                },
                correctAnswerMessage: {
                    type: String,
                    notify: true,
                },
                wrongAnswerMessage: {
                    type: String,
                    notify: true,
                },
                resourceStatus: {
                    type: String,
                    notify: true,
                },
                correctAnswer: {
                    type: String,
                    notify: true,
                },

                wrongAnswer1: {
                    type: String,
                    notify: true,
                },
                wrongAnswer2: {
                    type: String,
                    notify: true,
                },

                conceptionMode: {
                    type: Boolean,
                    notify: true,
                },
                distractors:{
                    type:Array,
                    notify:true,
                },
                preview: {
                    type: Boolean,
                    notify: true,
                },
                media: {
                    type: Object,
                    notify: true,
                },
                resourceLabel: {
                    type: String,
                    notify: true,
                },
            }
        });
    })();
    </script>
</dom-module>